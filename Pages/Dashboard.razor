@page "/"
@using IdleOptimizer.Models
@using IdleOptimizer.Services
@using MudBlazor
@using Microsoft.AspNetCore.Components.Forms
@using Microsoft.JSInterop
@inject ICalculationService CalculationService
@inject ISnackbar Snackbar
@inject IDialogService DialogService
@inject ILocalStorageService LocalStorageService
@inject IJSRuntime JSRuntime
@implements IDisposable

<MudContainer MaxWidth="MaxWidth.ExtraLarge" Class="mt-4">
    <MudCard>
        <MudCardContent>
            <MudText Typo="Typo.h4" Class="mb-4">Idle Game Optimizer</MudText>
            <MudText Typo="Typo.body1" Class="mb-4">
                Total Production: <strong>@FormatNumber(CalculationService.GetTotalProduction())</strong>
            </MudText>

            <MudButton Variant="Variant.Filled" Color="Color.Primary" StartIcon="@Icons.Material.Filled.Add" 
                       OnClick="OpenAddGeneratorDialog" Class="mb-2 mr-2">
                Add Generator
            </MudButton>
            <MudButton Variant="Variant.Filled" Color="Color.Secondary" StartIcon="@Icons.Material.Filled.Add" 
                       OnClick="OpenAddResearchDialog" Class="mb-2">
                Add Research
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Info" StartIcon="@Icons.Material.Filled.Refresh" 
                       OnClick="RefreshRankings" Class="mb-2 ml-2">
                Refresh Rankings
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Error" StartIcon="@Icons.Material.Filled.DeleteSweep" 
                       OnClick="OpenDeleteAllDialog" Class="mb-2 ml-2">
                Delete All
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Success" StartIcon="@Icons.Material.Filled.Download" 
                       OnClick="DownloadSaveFiles" Class="mb-2 ml-2">
                Download Save Files
            </MudButton>
            <MudButton Variant="Variant.Outlined" Color="Color.Warning" StartIcon="@Icons.Material.Filled.Upload" 
                       OnClick="TriggerFileInput" Class="mb-2 ml-2">
                Import Save Files
            </MudButton>
            <InputFile OnChange="HandleFileUpload" multiple accept=".csv" style="display: none;" @ref="fileInputElement" id="csvFileInput" />

            <MudTable Items="@rankedUpgrades" Hover="true" Dense="true" Striped="true" Bordered="true" 
                      Elevation="2" Class="mt-4">
                <HeaderContent>
                    <MudTh>Item Name</MudTh>
                    <MudTh>Type</MudTh>
                    <MudTh>Target</MudTh>
                    <MudTh Align="Align.Right">Contribute</MudTh>
                    <MudTh Align="Align.Right">Cost</MudTh>
                    <MudTh Align="Align.Right">Gain</MudTh>
                    <MudTh Align="Align.Right">Cascade Score</MudTh>
                    <MudTh Align="Align.Center">Timer</MudTh>
                    <MudTh>Actions</MudTh>
                </HeaderContent>
                <RowTemplate>
                    @{
                        var isEditing = IsEditing(context);
                        var editItem = isEditing ? GetOrCreateEditItem(context) : context;
                    }
                    <MudTd DataLabel="Item Name">
                        @if (isEditing)
                        {
                            <MudTextField @bind-Value="@editItem.ItemName" Variant="Variant.Outlined" Dense="true" />
                        }
                        else
                        {
                            @context.ItemName
                        }
                    </MudTd>
                    <MudTd DataLabel="Type">
                        @if (isEditing)
                        {
                            <MudSelect T="string" @bind-Value="@editItem.Type" Variant="Variant.Outlined" Dense="true">
                                <MudSelectItem Value="@("Generator")">Generator</MudSelectItem>
                                <MudSelectItem Value="@("Research")">Research</MudSelectItem>
                            </MudSelect>
                        }
                        else
                        {
                            <MudChip Size="Size.Small" Color="@(context.Type == "Generator" ? Color.Primary : Color.Secondary)">
                                @context.Type
                            </MudChip>
                        }
                    </MudTd>
                    <MudTd DataLabel="Target">
                        @if (context.Type == "Research" && context.SourceItem is Research research)
                        {
                            @if (research.TargetGenerators != null && research.TargetGenerators.Count > 0)
                            {
                                @foreach (var target in research.TargetGenerators)
                                {
                                    <div class="mb-1">
                                        @target <span style="color: #4caf50; font-weight: bold;">(x@((research.MultiplierValue ).ToString("F0")))</span>
                                    </div>
                                }
                            }
                            else
                            {
                                <span>-</span>
                            }
                        }
                        else
                        {
                            <span>-</span>
                        }
                    </MudTd>
                    <MudTd DataLabel="Contribute" Align="Align.Right">
                        @if (context.Type == "Generator" && context.SourceItem is Generator generator)
                        {
                            @if (isEditing)
                            {
                                <MudStack Row="true" Spacing="2">
                                    <MudNumericField @bind-Value="@editItem.BaseProduction"
                                                     Label="Base Production"
                                                     Variant="Variant.Outlined"
                                                     Dense="true"
                                                     Style="flex: 1;" />
                                    <MudSelect T="string" @bind-Value="@editBaseProductionAbbr" Label="Abbr" Variant="Variant.Outlined" 
                                               Style="width: 100px;" Dense="true">
                                        <MudSelectItem Value="@((string?)null)">None</MudSelectItem>
                                        <MudSelectItem Value="@("K")">K</MudSelectItem>
                                        <MudSelectItem Value="@("M")">M</MudSelectItem>
                                        <MudSelectItem Value="@("B")">B</MudSelectItem>
                                        <MudSelectItem Value="@("T")">T</MudSelectItem>
                                        <MudSelectItem Value="@("Qa")">Qa</MudSelectItem>
                                        <MudSelectItem Value="@("Qi")">Qi</MudSelectItem>
                                        <MudSelectItem Value="@("Sx")">Sx</MudSelectItem>
                                        <MudSelectItem Value="@("Sp")">Sp</MudSelectItem>
                                        <MudSelectItem Value="@("Oc")">Oc</MudSelectItem>
                                        <MudSelectItem Value="@("No")">No</MudSelectItem>
                                    </MudSelect>
                                </MudStack>
                                <MudNumericField @bind-Value="@editItem.Count"
                                                 Label="Count"
                                                 Variant="Variant.Outlined"
                                                 Dense="true"
                                                 Style="flex: 1;" />
                            }
                            else
                            {
                                var contribution = GetGeneratorContribution(generator);
                                var totalProduction = CalculationService.GetTotalProduction();
                                var percentage = totalProduction > 0 ? (contribution / totalProduction) * 100 : 0;
                                <MudStack Row="true" Spacing="2">
                                    <strong>@FormatNumber(generator.BaseProduction, 2) x @generator.Count = @FormatNumber(contribution, 2)</strong>
                                    <div class="text-caption" style="color: #90caf9;">
                                        (@percentage.ToString("F1")%)
                                    </div>
                                </MudStack>
                            }
                        }
                        else
                        {
                            <span>-</span>
                        }
                    </MudTd>
                    <MudTd DataLabel="Cost" Align="Align.Right">
                        @if (isEditing)
                        {
                            <div>
                                <MudStack Row="true" Spacing="2">
                                    <MudNumericField @bind-Value="@editItem.Cost"
                                                     Label="Cost (for 10 units)"
                                                     Variant="Variant.Outlined"
                                                     Dense="true"
                                                     Style="flex: 1;" />
                                    <MudSelect T="string" @bind-Value="@editCostAbbr" Label="Abbr" Variant="Variant.Outlined"
                                               Style="width: 100px;" Dense="true">
                                        <MudSelectItem Value="@((string?)null)">None</MudSelectItem>
                                        <MudSelectItem Value="@("K")">K</MudSelectItem>
                                        <MudSelectItem Value="@("M")">M</MudSelectItem>
                                        <MudSelectItem Value="@("B")">B</MudSelectItem>
                                        <MudSelectItem Value="@("T")">T</MudSelectItem>
                                        <MudSelectItem Value="@("Qa")">Qa</MudSelectItem>
                                        <MudSelectItem Value="@("Qi")">Qi</MudSelectItem>
                                        <MudSelectItem Value="@("Sx")">Sx</MudSelectItem>
                                        <MudSelectItem Value="@("Sp")">Sp</MudSelectItem>
                                        <MudSelectItem Value="@("Oc")">Oc</MudSelectItem>
                                        <MudSelectItem Value="@("No")">No</MudSelectItem>
                                    </MudSelect>
                                </MudStack>
                                
                                <div class="text-caption mt-1">Formatted: @FormatNumber(editItem.Cost)</div>
                            </div>
                        }
                        else
                        {
                            <div>
                                <MudText Typo="Typo.body1" Style="font-weight: bold;">@FormatNumber(context.Cost)</MudText>
                            </div>
                        }
                    </MudTd>
                    <MudTd DataLabel="Gain" Align="Align.Right">
                        @FormatNumber(context.Gain, 2)
                    </MudTd>
                    <MudTd DataLabel="Cascade Score" Align="Align.Right">
                        <MudChip Size="Size.Small" Color="@GetCascadeScoreColor(context.CascadeScore)">
                            @FormatNumber(context.CascadeScore, 4)
                        </MudChip>
                    </MudTd>
                    <MudTd DataLabel="Timer" Align="Align.Center">
                        @{
                            var timeToAfford = GetTimeToAfford(context);
                        }
                        @if (timeToAfford > 0)
                        {
                            <MudChip Size="Size.Small" Color="Color.Warning">
                                @FormatTime(timeToAfford)
                            </MudChip>
                        }
                        else
                        {
                            <MudChip Size="Size.Small" Color="Color.Success">
                                Ready
                            </MudChip>
                        }
                    </MudTd>
                    <MudTd DataLabel="Actions">
                        @if (isEditing)
                        {
                            <MudButton Size="Size.Small" Variant="Variant.Filled" Color="Color.Primary" 
                                       StartIcon="@Icons.Material.Filled.Save" 
                                       OnClick="async () => await SaveEdit(context)" Class="mr-1">
                                Update
                            </MudButton>
                            <MudButton Size="Size.Small" Variant="Variant.Outlined" Color="Color.Default" 
                                       StartIcon="@Icons.Material.Filled.Refresh" 
                                       OnClick="() => CancelEdit(context)" Class="mr-1">
                                Cancel
                            </MudButton>
                        }
                        else
                        {
                            <MudButton Size="Size.Small" Variant="Variant.Filled" Color="Color.Success" 
                                       StartIcon="@Icons.Material.Filled.ShoppingCart" 
                                       OnClick="async () => await ApplyPurchase(context)" Class="mr-1">
                                Apply
                            </MudButton>
                            <MudButton Size="Size.Small" Variant="Variant.Outlined" Color="Color.Primary" 
                                       StartIcon="@Icons.Material.Filled.Edit" 
                                       OnClick="() => StartEdit(context)" Class="mr-1">
                                Edit
                            </MudButton>
                            <MudButton Size="Size.Small" Variant="Variant.Outlined" Color="Color.Error" 
                                       StartIcon="@Icons.Material.Filled.Delete" 
                                       OnClick="async () => await DeleteItem(context)">
                                Delete
                            </MudButton>
                        }
                    </MudTd>
                </RowTemplate>
                <PagerContent>
                    <MudTablePager />
                </PagerContent>
            </MudTable>
        </MudCardContent>
    </MudCard>
</MudContainer>

@code {
    private List<UpgradeResult> rankedUpgrades = new();
    private Dictionary<object, UpgradeResult> editItems = new();
    private Dictionary<string, DateTime> timerStartTimes = new();
    private System.Threading.Timer? _timer;
    private double _lastTotalProduction = 0;
    private const double ProductionPerSecond = 1.0; // Production rate per second
    private string? editBaseProductionAbbr = null;
    private string? editCostAbbr = null;
    private InputFile fileInputElement = default!;

    protected override async Task OnInitializedAsync()
    {
        await CalculationService.InitializeAsync();
        RefreshRankings();
        _lastTotalProduction = CalculationService.GetTotalProduction();
        
        // Initialize timer to update every second
        _timer = new System.Threading.Timer(TimerCallback, null, TimeSpan.Zero, TimeSpan.FromSeconds(1));
    }

    private void RefreshRankings()
    {
        rankedUpgrades = CalculationService.GetRankedUpgrades();
        // Clear edit items for items that no longer exist
        var currentSourceItems = rankedUpgrades.Select(r => r.SourceItem).Where(s => s != null).ToList();
        var keysToRemove = editItems.Keys.Where(k => !currentSourceItems.Contains(k)).ToList();
        foreach (var key in keysToRemove)
        {
            editItems.Remove(key);
        }
        // Clear timer cache to force recalculation
        timerStartTimes.Clear();
        StateHasChanged();
    }

    private bool IsEditing(UpgradeResult item)
    {
        return item.SourceItem != null && editItems.ContainsKey(item.SourceItem);
    }

    private void StartEdit(UpgradeResult item)
    {
        if (item.SourceItem == null) return;

        if (!editItems.ContainsKey(item.SourceItem))
        {
            editItems[item.SourceItem] = new UpgradeResult
            {
                ItemName = item.ItemName,
                Type = item.Type,
                Cost = item.Cost,
                Gain = item.Gain,
                BaseProduction = item.SourceItem is Generator gen ? gen.BaseProduction : 0,
                Count = item.SourceItem is Generator generator ? generator.Count : 0,
                TargetGenerators = item.TargetGenerators,
                SourceItem = item.SourceItem
            };
        }
        StateHasChanged();
    }

    private UpgradeResult GetOrCreateEditItem(UpgradeResult item)
    {
        if (item.SourceItem == null) return item;

        return editItems[item.SourceItem];
    }

    private async Task ApplyPurchase(UpgradeResult upgrade)
    {
        // Check if this is a Generator with CostRatio == 0
        if (upgrade.SourceItem is Generator generator && generator.CostRatio <= 0)
        {
            // Show dialog to get new cost
            var parameters = new DialogParameters
            {
                ["CalculationService"] = CalculationService,
                ["CurrentCost"] = generator.Cost
            };

            var options = new DialogOptions { CloseOnEscapeKey = true, MaxWidth = MaxWidth.Small, FullWidth = true };
            var dialog = await DialogService.ShowAsync<NewCostDialog>("Enter New Cost", parameters, options);
            var result = await dialog.Result;

            if (result.Canceled)
            {
                return; // User cancelled, don't apply purchase
            }

            // Calculate CostRatio from new cost
            if (result.Data is double newCost && newCost > 0)
            {
                generator.CostRatio = newCost / generator.Cost;
            }
            else
            {
                Snackbar.Add("Invalid cost entered", Severity.Error);
                return;
            }
        }

        await CalculationService.AppliedPurchaseAsync(upgrade);
        RefreshRankings();
        Snackbar.Add($"Applied purchase: {upgrade.ItemName}", Severity.Success);
    }

    private async Task SaveEdit(UpgradeResult item)
    {
        if (item.SourceItem == null || !editItems.ContainsKey(item.SourceItem)) return;

        var editItem = editItems[item.SourceItem];

        if (item.SourceItem is Generator generator)
        {
            generator.Name = editItem.ItemName;
            var effectiveBase = CalculationService.ApplyAbbreviation(editItem.BaseProduction, editBaseProductionAbbr);
            var effectiveCost = CalculationService.ApplyAbbreviation(editItem.Cost, editCostAbbr);
            generator.BaseProduction = effectiveBase;
            generator.Cost = effectiveCost;
            generator.Count = editItem.Count;
        }
        else if (item.SourceItem is Research research)
        {
            research.Name = editItem.ItemName;
            research.Cost = editItem.Cost;
        }

        // Exit edit mode for this row
        editItems.Remove(item.SourceItem);

        await CalculationService.SaveStateAsync();
        RefreshRankings();
        Snackbar.Add("Item updated successfully", Severity.Success);
    }

    private void CancelEdit(UpgradeResult item)
    {
        if (item.SourceItem != null && editItems.ContainsKey(item.SourceItem))
        {
            editItems.Remove(item.SourceItem);
        }
        RefreshRankings();
    }

    private async Task DeleteItem(UpgradeResult item)
    {
        if (item.SourceItem is Generator generator)
        {
            CalculationService.Generators.Remove(generator);
        }
        else if (item.SourceItem is Research research)
        {
            CalculationService.Research.Remove(research);
        }

        await CalculationService.SaveStateAsync();
        RefreshRankings();
        Snackbar.Add("Item deleted successfully", Severity.Info);
    }

    private Color GetCascadeScoreColor(double cascadeScore)
    {
        if (cascadeScore > 10) return Color.Success;
        if (cascadeScore > 1) return Color.Warning;
        if (cascadeScore > 0) return Color.Info;
        return Color.Default;
    }

    private double GetGeneratorContribution(Generator generator)
    {
        // BaseProduction already includes all applied research multipliers
        return generator.GetCurrentProduction();
    }

    private string FormatNumber(double value, int decimals = 2)
    {
        if (double.IsNaN(value) || double.IsInfinity(value))
            return "0";

        double absValue = Math.Abs(value);
        string sign = value < 0 ? "-" : "";
        string format = $"F{decimals}";

        if (absValue >= 1e30) // Nonillion
        {
            return $"{sign}{(absValue / 1e30).ToString(format)}No";
        }
        else if (absValue >= 1e27) // Octillion
        {
            return $"{sign}{(absValue / 1e27).ToString(format)}Oc";
        }
        else if (absValue >= 1e24) // Septillion
        {
            return $"{sign}{(absValue / 1e24).ToString(format)}Sp";
        }
        else if (absValue >= 1e21) // Sextillion
        {
            return $"{sign}{(absValue / 1e21).ToString(format)}Sx";
        }
        else if (absValue >= 1e18) // Quintillion
        {
            return $"{sign}{(absValue / 1e18).ToString(format)}Qi";
        }
        else if (absValue >= 1e15) // Quadrillion
        {
            return $"{sign}{(absValue / 1e15).ToString(format)}Qa";
        }
        else if (absValue >= 1e12) // Trillion
        {
            return $"{sign}{(absValue / 1e12).ToString(format)}T";
        }
        else if (absValue >= 1e9) // Billion
        {
            return $"{sign}{(absValue / 1e9).ToString(format)}B";
        }
        else if (absValue >= 1e6) // Million
        {
            return $"{sign}{(absValue / 1e6).ToString(format)}M";
        }
        else if (absValue >= 1e3) // Thousand
        {
            return $"{sign}{(absValue / 1e3).ToString(format)}K";
        }
        else
        {
            return $"{sign}{absValue.ToString(format)}";
        }
    }

    private async Task OpenAddGeneratorDialog()
    {
        var parameters = new DialogParameters
        {
            ["CalculationService"] = CalculationService
        };

        var options = new DialogOptions { CloseOnEscapeKey = true, MaxWidth = MaxWidth.Small, FullWidth = true };
        var dialog = await DialogService.ShowAsync<AddGeneratorDialog>("Add Generator", parameters, options);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            RefreshRankings();
        }
    }

    private async Task OpenAddResearchDialog()
    {
        var parameters = new DialogParameters
        {
            ["CalculationService"] = CalculationService
        };

        var options = new DialogOptions { CloseOnEscapeKey = true, MaxWidth = MaxWidth.Small, FullWidth = true };
        var dialog = await DialogService.ShowAsync<AddResearchDialog>("Add Research", parameters, options);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            RefreshRankings();
        }
    }

    private async Task OpenDeleteAllDialog()
    {
        var options = new DialogOptions { CloseOnEscapeKey = true, MaxWidth = MaxWidth.Small, FullWidth = true };
        var dialog = await DialogService.ShowAsync<DeleteAllConfirmationDialog>("Delete All Items", options);
        var result = await dialog.Result;

        if (!result.Canceled)
        {
            await CalculationService.ClearAllAsync();
            RefreshRankings();
            Snackbar.Add("All items deleted successfully", Severity.Info);
        }
    }

    private async Task DownloadSaveFiles()
    {
        try
        {
            await LocalStorageService.ExportGeneratorsToFileAsync(CalculationService.Generators);
            await LocalStorageService.ExportResearchToFileAsync(CalculationService.Research);
            Snackbar.Add("CSV files downloaded successfully", Severity.Success);
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error downloading files: {ex.Message}", Severity.Error);
        }
    }

    private async Task TriggerFileInput()
    {
        // Use direct DOM manipulation which is more reliable
        await JSRuntime.InvokeVoidAsync("eval", "document.getElementById('csvFileInput')?.click();");
    }

    private async Task HandleFileUpload(InputFileChangeEventArgs e)
    {
        try
        {
            bool generatorsImported = false;
            bool researchImported = false;

            foreach (var file in e.GetMultipleFiles())
            {
                var fileName = file.Name.ToLower();
                using var stream = file.OpenReadStream(maxAllowedSize: 10 * 1024 * 1024); // 10MB max
                using var reader = new StreamReader(stream);
                var csvContent = await reader.ReadToEndAsync();

                if (fileName.Contains("generator"))
                {
                    await LocalStorageService.ImportGeneratorsFromFileAsync(csvContent);
                    generatorsImported = true;
                }
                else if (fileName.Contains("research"))
                {
                    await LocalStorageService.ImportResearchFromFileAsync(csvContent);
                    researchImported = true;
                }
            }

            // Reload the state from storage
            await CalculationService.LoadStateAsync();
            
            // Update total production to trigger recalculation
            _lastTotalProduction = CalculationService.GetTotalProduction();
            
            // Refresh rankings to recalculate cascade scores and timers
            RefreshRankings();
            
            // Force state update to ensure UI reflects new data
            StateHasChanged();

            if (generatorsImported && researchImported)
            {
                Snackbar.Add("Both CSV files imported successfully", Severity.Success);
            }
            else if (generatorsImported)
            {
                Snackbar.Add("Generators CSV file imported successfully", Severity.Success);
            }
            else if (researchImported)
            {
                Snackbar.Add("Research CSV file imported successfully", Severity.Success);
            }
            else
            {
                Snackbar.Add("No valid CSV files found. Please select generators.csv or research.csv", Severity.Warning);
            }
        }
        catch (Exception ex)
        {
            Snackbar.Add($"Error importing files: {ex.Message}", Severity.Error);
        }
    }

    private void TimerCallback(object? state)
    {
        InvokeAsync(() =>
        {
            // Check if total production changed
            var currentProduction = CalculationService.GetTotalProduction();
            if (Math.Abs(currentProduction - _lastTotalProduction) > 0.001)
            {
                _lastTotalProduction = currentProduction;
                // Clear timer cache to force recalculation
                timerStartTimes.Clear();
            }
            StateHasChanged();
        });
    }

    private int GetTimeToAfford(UpgradeResult item)
    {
        var totalProduction = CalculationService.GetTotalProduction();
        
        // If no production, return a large number
        if (totalProduction <= 0)
        {
            return int.MaxValue;
        }
        
        // Calculate production per second (assuming total production is per second)
        // You can adjust ProductionPerSecond multiplier if production is per different time unit
        var productionPerSecond = totalProduction * ProductionPerSecond;
        
        // Calculate time needed to afford this item (in seconds)
        var timeNeeded = item.Cost / productionPerSecond;
        
        // Get the timer key for this item
        var timerKey = $"{item.Type}_{item.ItemName}";
        
        // Check if we need to recalculate (production changed or timer expired)
        var needsRecalculation = !timerStartTimes.ContainsKey(timerKey);
        
        if (!needsRecalculation)
        {
            var endTime = timerStartTimes[timerKey];
            var elapsed = (DateTime.Now - (endTime.AddSeconds(-timeNeeded))).TotalSeconds;
            var currentTimeNeeded = item.Cost / productionPerSecond;
            
            // Recalculate if production changed significantly (more than 1% difference)
            if (Math.Abs(currentTimeNeeded - timeNeeded) / Math.Max(currentTimeNeeded, 1) > 0.01)
            {
                needsRecalculation = true;
            }
        }
        
        if (needsRecalculation)
        {
            // Recalculate based on current production
            timerStartTimes[timerKey] = item.AvailableAt!.Value;
        }
        
        var remaining = (int)(item.AvailableAt!.Value - DateTime.Now).TotalSeconds;
        return Math.Max(0, remaining);
    }

    private string FormatTime(int seconds)
    {
        if (seconds < 60)
        {
            return $"{seconds}s";
        }
        else
        {
            int minutes = seconds / 60;
            int secs = seconds % 60;
            return $"{minutes}m {secs}s";
        }
    }

    public void Dispose()
    {
        _timer?.Dispose();
    }
}